# v0.5 Release Criteria: CLI-Only Release

**Project:** Unified Theming
**Version:** v0.5.0
**Release Type:** CLI-Only (No GUI)
**Target Date:** Week 2, Day 5 (October 31, 2025)
**Author:** Claude Code
**Date:** October 21, 2025

---

## Executive Summary

v0.5.0 represents the **Phase 2 completion milestone** - a production-ready CLI application with comprehensive test coverage. This is a **headless/CLI-only release** intended for:
- Power users who prefer command-line interfaces
- Validation of core theming logic before GUI development
- Early adopter feedback on theme compatibility
- Testing foundation for Phase 3 (GUI)

**v0.5.0 is NOT feature-complete.** It lacks:
- ❌ GUI (coming in v0.8/v1.0)
- ❌ Full container support (Flatpak/Snap partial)
- ❌ Advanced features (theme customization, color schemes)

---

## Release Scope

### ✅ Included Features

**Core Functionality:**
- Theme discovery across system theme directories (`~/.themes`, `/usr/share/themes`, etc.)
- Theme parsing and metadata extraction (GTK2/3/4 themes)
- Theme application to GTK2/3/4 and libadwaita (via CSS injection)
- Qt5/6 theming (kdeglobals + Kvantum)
- Flatpak theme overrides (portal configuration)
- Snap theme support (basic interface management)
- Automatic backup before theme changes
- Manual backup/restore operations
- Rollback on catastrophic failures (>50% handler failures)

**CLI Commands:**
- `unified-theming list` - Discover and list available themes
- `unified-theming apply <theme_name>` - Apply a theme to all toolkits
- `unified-theming apply <theme_name> --targets gtk,qt` - Targeted application
- `unified-theming current` - Show currently applied themes per toolkit
- `unified-theming backup` - Create manual backup
- `unified-theming restore <backup_id>` - Restore from backup
- `unified-theming list-backups` - Show available backups

**Quality Assurance:**
- ≥80% overall test coverage
- All critical modules ≥70% coverage
- Zero P0/P1 bugs in QA validation
- Type-safe (mypy strict mode passes)
- Performance benchmarks met (theme discovery <5s, application <2s)

### ❌ Excluded Features (Coming in v0.8/v1.0)

**Not in v0.5:**
- GUI application (PyQt6 interface)
- Theme preview functionality
- Live theme switching with preview
- Theme customization (color overrides)
- Advanced container support (comprehensive Flatpak/Snap theming)
- Icon theme management
- Font theming
- Cursor theme management
- Desktop environment-specific optimizations (GNOME/KDE tweaks)
- Theme import/export
- Custom theme creation
- Packaging (Flatpak/AppImage/PPA/AUR)

---

## Release Validation Criteria

### 1. Test Coverage Requirements (MANDATORY)

**Overall Coverage:**
- [ ] **Overall project coverage ≥80%** (measured via `pytest --cov`)

**Per-Module Coverage (Critical Modules):**
- [ ] `unified_theming/utils/color.py`: ≥80%
- [ ] `unified_theming/core/manager.py`: ≥85%
- [ ] `unified_theming/core/parser.py`: ≥87% (current: 87%, maintain)
- [ ] `unified_theming/core/config.py`: ≥70%
- [ ] `unified_theming/core/types.py`: ≥89% (current: 89%, maintain)
- [ ] `unified_theming/handlers/gtk_handler.py`: ≥70%
- [ ] `unified_theming/handlers/qt_handler.py`: ≥85%
- [ ] `unified_theming/handlers/flatpak_handler.py`: ≥75%
- [ ] `unified_theming/handlers/snap_handler.py`: ≥60%
- [ ] `unified_theming/handlers/base.py`: ≥83% (current: 83%, maintain)
- [ ] `unified_theming/cli/commands.py`: ≥80%
- [ ] `unified_theming/utils/validation.py`: ≥70%

**Test Quality:**
- [ ] All tests pass (100% pass rate)
- [ ] No skipped tests in critical modules
- [ ] No `@pytest.mark.xfail` in production code paths
- [ ] Integration tests pass (end-to-end workflows)
- [ ] Performance tests meet benchmarks

**Validation Command:**
```bash
# Run coverage validation
pytest --cov=unified_theming --cov-report=xml --cov-report=html --cov-report=term

# Verify overall coverage ≥80%
coverage report --fail-under=80

# Check per-module coverage
coverage report --include="unified_theming/utils/color.py"
coverage report --include="unified_theming/core/manager.py"
# ... (repeat for all critical modules)
```

---

### 2. Functional Testing (MANDATORY)

**Installation Testing:**
- [ ] Clean Ubuntu 22.04 install succeeds (`pip install -e .`)
- [ ] Clean Ubuntu 24.04 install succeeds
- [ ] Clean Fedora 40 install succeeds
- [ ] Dependencies resolve correctly (no conflicts)
- [ ] Virtual environment installation works
- [ ] CLI executable available after install (`which unified-theming`)

**CLI Smoke Tests:**
```bash
# Test 1: List themes
unified-theming list
# Expected: Returns list of discovered themes, no errors

# Test 2: Show current theme
unified-theming current
# Expected: Shows current theme per toolkit (GTK3/GTK4/Qt/etc.)

# Test 3: Apply a system theme (Adwaita-dark)
unified-theming apply Adwaita-dark
# Expected: Applies theme, shows success message, no errors

# Test 4: Verify theme applied
unified-theming current
# Expected: Shows Adwaita-dark as current theme

# Test 5: Create backup
unified-theming backup
# Expected: Creates backup, returns backup ID

# Test 6: List backups
unified-theming list-backups
# Expected: Shows at least 1 backup (from Test 5)

# Test 7: Restore backup
unified-theming restore <backup_id_from_test_5>
# Expected: Restores previous theme, success message

# Test 8: Targeted application (GTK only)
unified-theming apply Adwaita --targets gtk
# Expected: Applies only to GTK, Qt unchanged

# Test 9: Error handling (invalid theme)
unified-theming apply NonExistentTheme
# Expected: User-friendly error message, non-zero exit code

# Test 10: Help text
unified-theming --help
unified-theming apply --help
# Expected: Shows usage information, all commands documented
```

**Checklist:**
- [ ] All 10 smoke tests pass on Ubuntu 22.04
- [ ] All 10 smoke tests pass on Ubuntu 24.04
- [ ] All 10 smoke tests pass on Fedora 40
- [ ] Error messages are user-friendly (no stack traces for expected errors)
- [ ] Exit codes correct (0 = success, 1 = user error, 2 = system error)

---

### 3. Performance Benchmarks (MANDATORY)

**Performance Requirements:**
- [ ] Theme discovery (100 themes): <5 seconds
- [ ] Theme discovery (500+ themes): <20 seconds
- [ ] Single theme parsing: <50ms
- [ ] Color extraction: <20ms
- [ ] Theme application (all handlers): <2 seconds
- [ ] CSS generation: <100ms
- [ ] Backup creation: <500ms
- [ ] Restore operation: <1 second

**Validation Command:**
```bash
# Run performance benchmarks
pytest tests/test_performance_stress.py -v

# Expected output:
# test_theme_discovery_100_themes: PASSED (3.2s < 5s) ✓
# test_theme_discovery_500_themes: PASSED (15.8s < 20s) ✓
# test_theme_parsing_latency: PASSED (42ms < 50ms) ✓
# test_color_extraction: PASSED (15ms < 20ms) ✓
# test_theme_application_e2e: PASSED (1.8s < 2s) ✓
# test_css_generation: PASSED (85ms < 100ms) ✓
# test_backup_creation: PASSED (380ms < 500ms) ✓
# test_restore_operation: PASSED (750ms < 1s) ✓
```

**Checklist:**
- [ ] All performance benchmarks pass
- [ ] No memory leaks detected (stress tests run without OOM)
- [ ] Rapid theme switching works (10 switches without crash)

---

### 4. Integration Testing (MANDATORY)

**End-to-End Workflows:**
- [ ] **Happy Path:** Discover → Parse → Apply → Verify (success)
- [ ] **Partial Failure:** GTK succeeds, Qt fails → Shows detailed results, no rollback
- [ ] **Catastrophic Failure:** All handlers fail → Triggers rollback, restores previous state
- [ ] **Backup/Restore:** Apply theme A → Backup → Apply theme B → Restore → Verify theme A restored
- [ ] **Multi-Handler:** Apply to gtk+qt only → Flatpak unchanged
- [ ] **Theme Switching:** Apply A → Apply B → Apply A → Verify consistency

**Validation Command:**
```bash
# Run integration tests
pytest tests/test_integration.py -v

# Expected: All scenarios pass
```

---

### 5. Code Quality (MANDATORY)

**Type Safety:**
- [ ] `mypy unified_theming/ --strict` - Zero errors
- [ ] All public functions have type hints
- [ ] All return types annotated

**Code Style:**
- [ ] `black unified_theming/ --check` - No formatting issues
- [ ] `isort unified_theming/ --check` - Imports sorted
- [ ] `flake8 unified_theming/` - No linting errors (or only acceptable warnings)

**Documentation:**
- [ ] All public functions have docstrings (Google style)
- [ ] README.md updated with v0.5 features
- [ ] INSTALL.md created with installation instructions
- [ ] CLI help text complete and accurate

---

### 6. Security & Safety (MANDATORY)

**File Operations:**
- [ ] No writes to system directories (`/usr`, `/etc`) - user config only
- [ ] Path validation prevents directory traversal attacks
- [ ] Backup restoration validates backup integrity
- [ ] No race conditions in file writes (atomic operations or locks)

**Error Handling:**
- [ ] No unhandled exceptions in CLI (all wrapped in try/except)
- [ ] No stack traces shown to users (logged only)
- [ ] Graceful degradation (missing toolkit doesn't crash app)

**Validation:**
- [ ] Security audit of file operations (no hardcoded paths)
- [ ] Input validation on theme names (prevent injection)
- [ ] Backup pruning doesn't delete wrong files

---

### 7. Known Limitations Documentation (MANDATORY)

**v0.5 Limitations (Must be documented in RELEASE_NOTES.md):**

**1. Container Support (Partial):**
- Flatpak: Basic portal configuration only (~40% functionality)
- Snap: Interface management only (~30% functionality)
- Per-app theming not fully supported

**2. Libadwaita Coverage (~70%):**
- Color variables mapped correctly
- Widget structure changes not applied (requires library patching)
- Some libadwaita apps may not reflect theme fully

**3. Qt Theming (Approximate):**
- Color translation from GTK→Qt is approximate (different semantic models)
- Kvantum required for best Qt theming results
- Some Qt apps may ignore kdeglobals

**4. No GUI:**
- CLI-only interface
- No theme preview
- No live switching with visual feedback

**5. Theme Compatibility:**
- Only GTK2/3/4 themes supported
- Qt-native themes not parsed
- Custom theme creation not supported

**Checklist:**
- [ ] All limitations documented in `docs/RELEASE_NOTES_v0.5.md`
- [ ] Known issues listed with workarounds (if any)
- [ ] Upgrade path to v1.0 described

---

## Release Approval Checklist

### Pre-Release (Week 2, Day 4)

**Code Freeze:**
- [ ] All Week 2 tests merged to main branch
- [ ] No open P0/P1 bugs in issue tracker
- [ ] Code review completed (Claude Code approval)
- [ ] Final coverage report generated

**QA Validation (Opencode AI):**
- [ ] `docs/v0.5_readiness_report.md` created
- [ ] All validation criteria checked
- [ ] Installation tested on 3 distros (Ubuntu 22.04/24.04, Fedora 40)
- [ ] Smoke tests pass (10/10)
- [ ] Performance benchmarks pass (8/8)

**Documentation (Claude Code):**
- [ ] `docs/RELEASE_NOTES_v0.5.md` finalized
- [ ] `docs/INSTALL_v0.5.md` created
- [ ] `README.md` updated with v0.5 info
- [ ] Changelog updated

### Release Day (Week 2, Day 5)

**Git Operations:**
- [ ] Create release branch: `git checkout -b release/v0.5`
- [ ] Bump version in `pyproject.toml` to `0.5.0`
- [ ] Tag release: `git tag -a v0.5.0 -m "Release v0.5.0: CLI-only release"`
- [ ] Merge to main: `git checkout main && git merge release/v0.5`
- [ ] Push tags: `git push origin main v0.5.0`

**Release Artifacts:**
- [ ] GitHub release created with tag `v0.5.0`
- [ ] Release notes attached (from `docs/RELEASE_NOTES_v0.5.md`)
- [ ] Source tarball uploaded (`.tar.gz`)
- [ ] Installation instructions linked (from `docs/INSTALL_v0.5.md`)

**Validation (Post-Release):**
- [ ] Install from PyPI (if published): `pip install unified-theming==0.5.0`
- [ ] Install from source: `pip install git+https://github.com/user/unified-theming@v0.5.0`
- [ ] Smoke test on fresh install
- [ ] Check GitHub release page displays correctly

**Communication:**
- [ ] Project README updated with v0.5 badge
- [ ] Announcement prepared (optional: blog post, social media)
- [ ] Early adopters notified (optional: mailing list, Discord, etc.)

---

## Rollback Plan (If Release Fails)

### Blocker Scenarios (NO-GO)

**Critical Issues (Immediate Rollback):**
1. **Overall coverage <80%** → Delay release, implement missing tests
2. **P0 bug discovered** → Fix bug, re-run QA validation
3. **Installation fails on Ubuntu 22.04/24.04** → Fix packaging, re-test
4. **Core CLI commands crash** → Fix crash, re-run smoke tests
5. **Data loss in backup/restore** → Fix critical bug, extensive re-testing

**Rollback Procedure:**
```bash
# 1. Delete release tag
git tag -d v0.5.0
git push origin :refs/tags/v0.5.0

# 2. Delete GitHub release
# (via GitHub UI or gh CLI: gh release delete v0.5.0)

# 3. Revert version bump
git revert <commit_hash_of_version_bump>

# 4. Communicate delay
# Update README with "v0.5 delayed to <new_date>"

# 5. Create issue for blocker
# Assign P0 priority, track resolution
```

### Non-Blocker Scenarios (GO with Caveats)

**Minor Issues (Release with Known Issues):**
1. **Coverage 75-79%** → Release with note, commit to 80% in v0.5.1
2. **P2 bug found** → Document in known issues, fix in v0.5.1
3. **Performance benchmark missed by <20%** → Document, optimize in v0.5.1
4. **Flatpak/Snap partial** → Expected limitation, document clearly

**Release with caveat:**
- Add "Known Issues" section to release notes
- Create tracking issues for follow-up fixes
- Target v0.5.1 within 1 week

---

## Success Metrics (Post-Release)

### Week 1 After Release

**Adoption Metrics:**
- [ ] ≥10 installations (GitHub stars, PyPI downloads)
- [ ] ≥3 user feedback reports (issues, discussions)
- [ ] ≥1 theme compatibility report (which themes work well)

**Quality Metrics:**
- [ ] Zero critical bugs reported
- [ ] <3 P1 bugs reported
- [ ] User-reported bugs have workarounds

**Feedback Loop:**
- [ ] User feedback incorporated into v0.5.1 or v1.0 planning
- [ ] Theme compatibility matrix started (which themes tested)

---

## v0.5.1 Criteria (Hotfix/Patch Release)

**Trigger for v0.5.1:**
- P0 bug discovered post-release
- Critical performance regression
- Data loss or corruption issue
- Security vulnerability

**v0.5.1 Timeline:**
- Discovery → Fix → QA → Release: 1-3 days
- No new features, bug fixes only
- Minimal testing (regression tests + fix validation)

---

## Post-v0.5 Roadmap (Phase 3)

**v0.6 (Week 4-5, Optional):**
- Early GUI preview (MainWindow + ThemeBrowser)
- Not released, internal milestone only

**v0.8 (Week 6, GUI Beta):**
- Full GUI functional
- Theme preview support
- Beta release for community testing

**v1.0 (Week 9-11, Final Release):**
- GUI polished
- Full container support (Flatpak/Snap)
- Packaging complete (Flatpak/AppImage/PPA/AUR)
- Production-ready

---

## Appendix: Release Checklist Template

```markdown
## v0.5.0 Release Checklist

**Date:** _______
**Release Manager:** _______

### Pre-Release Validation
- [ ] Coverage ≥80% (actual: ___%)
- [ ] All critical modules meet targets
- [ ] Smoke tests pass (10/10)
- [ ] Performance benchmarks pass (8/8)
- [ ] Integration tests pass
- [ ] No P0/P1 bugs open

### Code Quality
- [ ] mypy --strict passes
- [ ] black --check passes
- [ ] flake8 clean
- [ ] All docstrings complete

### Documentation
- [ ] RELEASE_NOTES_v0.5.md finalized
- [ ] INSTALL_v0.5.md created
- [ ] README.md updated
- [ ] Known limitations documented

### Installation Testing
- [ ] Ubuntu 22.04: PASS / FAIL
- [ ] Ubuntu 24.04: PASS / FAIL
- [ ] Fedora 40: PASS / FAIL

### Release Operations
- [ ] Version bumped to 0.5.0
- [ ] Git tag created: v0.5.0
- [ ] GitHub release published
- [ ] Release notes attached
- [ ] Source tarball uploaded

### Post-Release
- [ ] Fresh install validated
- [ ] Smoke test on release build
- [ ] README badge updated
- [ ] Announcement sent (optional)

### Sign-Off
- [ ] Qwen Coder (Implementation): _______
- [ ] Opencode AI (QA): _______
- [ ] Claude Code (Release Manager): _______

**Status:** APPROVED / DELAYED / REJECTED
**Notes:** _______
```

---

## Contact & Escalation

**Blocker Found During Release:**
1. Document issue in `docs/v0.5_blockers.md`
2. Create P0 GitHub issue
3. Convene all agents for resolution plan
4. Decide: Fix in 24h (release) or Delay release (fix properly)

**Post-Release Critical Bug:**
1. Create P0 issue immediately
2. Assess impact (data loss? crash? minor?)
3. If critical: Prepare v0.5.1 hotfix
4. If minor: Track for v0.5.1 or v1.0

---

**This document defines the quality bar for v0.5.0. All criteria must be met for release approval.** ✅

**Target Date:** Week 2, Day 5 (October 31, 2025)
**Confidence:** 85% (based on Grade A execution plan)

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-10-21 | Initial release criteria | Claude Code |
